---
  - hosts: all
    become: yes

    tasks:
      - name: Install nginx
        yum: name=nginx state=present

      - name: Configure nginx
        template:
          src: files/nginx.conf.j2
          dest: /etc/nginx/nginx.conf
          owner: root
          group: root
          mode: 0644

      - name: Start nginx
        service:
          name: nginx
          state: started

      - name: Configure nginx site
        template:
          src: files/default.conf.j2
          dest: /etc/nginx/conf.d/default.conf
          owner: root
          group: root
          mode: 0644

      - name: Start nginx site
        service:
          name: nginx
          state: restarted

      - name: Configure nginx site
        template:
          src: site.conf.j2
          dest: /etc/nginx/conf.d/site.conf
          owner: root
          group: root
          mode: 0644

      - name: Start nginx site
        service:
          name: nginx
          state: restarted